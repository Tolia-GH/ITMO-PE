{"ast":null,"code":"var _jsxFileName = \"/Users/2398768715qq.com/Documents/GitHub/ITMO-PE/ProgramWeb/Lab4temp/demo_front/my-app/src/components/main/mainGraph.jsx\";\nimport React from \"react\";\nimport PropTypes from \"prop-types\";\nimport { connect } from \"react-redux\";\nimport $ from \"jquery\";\nimport { addDot } from \"../reduxStore/action/action\"; //pure ui\n\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst x = 156;\nconst y = 156;\nconst r = 100;\n\nclass CanvasGraphComponent extends React.Component {\n  componentDidMount() {\n    const {\n      R,\n      clearCanvas,\n      drawBackground\n    } = this.props;\n    let username = window.sessionStorage.getItem(\"username\");\n\n    if (!(username === null || username === \"\")) {\n      clearCanvas(this.refs.canvas.getContext(\"2d\"));\n      drawBackground(this.refs.canvas.getContext(\"2d\"), R);\n    }\n  }\n\n  componentDidUpdate(prevProps, prevState, snapshot) {\n    const {\n      R,\n      clearCanvas,\n      drawBackground,\n      drawDots,\n      Dots\n    } = this.props;\n    let username = window.sessionStorage.getItem(\"username\");\n\n    if (!(username === null || username === \"\")) {\n      clearCanvas(this.refs.canvas.getContext(\"2d\"));\n      drawBackground(this.refs.canvas.getContext(\"2d\"), R);\n\n      if (Dots.length > 0 || R > 0) {\n        drawDots(Dots, this.refs.canvas.getContext(\"2d\"), R);\n      }\n    }\n  }\n\n  render() {\n    const {\n      clickGraph,\n      R\n    } = this.props;\n    let username = window.sessionStorage.getItem(\"username\");\n\n    if (username === null || username === \"\") {\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        children: \" \"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 37,\n        columnNumber: 21\n      }, this);\n    }\n\n    return /*#__PURE__*/_jsxDEV(\"canvas\", {\n      ref: \"canvas\",\n      id: \"click_graph\",\n      width: 312,\n      height: 312,\n      onClick: event => {\n        clickGraph(document.getElementById(\"click_graph\").getBoundingClientRect(), event, R);\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 40,\n      columnNumber: 13\n    }, this);\n  }\n\n}\n\nCanvasGraphComponent.propTypes = {\n  R: PropTypes.number.isRequired,\n  Dots: PropTypes.array.isRequired,\n  drawBackground: PropTypes.func.isRequired,\n  clearCanvas: PropTypes.func.isRequired,\n  drawDots: PropTypes.func.isRequired,\n  clickGraph: PropTypes.func.isRequired\n};\n\nfunction mapStateToProps(state) {\n  return {\n    R: state.dot.R,\n    Dots: state.dot.Dots\n  };\n} //functions won't change state, so here don't use dispatcher and reducer\n\n\nfunction mapDispatchToProps(dispatch) {\n  return {\n    drawBackground: (refs, R) => drawBackground(refs, R),\n    clearCanvas: refs => clearCanvas(refs),\n    drawDots: (Dots, refs, R) => drawDots(Dots, refs, R),\n    //refs should be this.refs\n    clickGraph: (browser, event, R) => {\n      let cx = translateClickX(browser, event.clientX, R);\n      let cy = translateClickY(browser, event.clientY, R);\n      $.ajax({\n        url: \"api/getDot\",\n        method: \"POST\",\n        data: {\n          X: cx,\n          Y: cy,\n          R: R,\n          Password: window.sessionStorage.getItem(\"password\"),\n          Username: window.sessionStorage.getItem(\"username\")\n        },\n        async: false,\n        success: function (res) {\n          if (res.wrong) {\n            alert(res.message);\n          } else {\n            dispatch(addDot(res.x, res.y + \"\", res.r, res.hit, res.date)); //alert(\"x=\"+res.x+\" y=\"+res.y+\" r=\"+res.r+\" hit=\"+res.hit+\" date=\"+res.date);\n          }\n        }\n      });\n    }\n  };\n}\n\nfunction drawBackground(refs, R) {\n  const pen = refs; //background\n\n  pen.fillStyle = \"white\";\n  pen.beginPath();\n  pen.clearRect(0, 0, 2 * x, 2 * y);\n  pen.rect(0, 0, 2 * x, 2 * y);\n  pen.closePath();\n  pen.fill(); //axis\n\n  pen.beginPath();\n  pen.strokeStyle = \"black\";\n  pen.font = \"20px Verdana\";\n  pen.strokeRect(0, 0, 2 * x, 2 * y); //y\n\n  pen.moveTo(x, 0);\n  pen.lineTo(x, 2 * y); //x\n\n  pen.moveTo(0, y);\n  pen.lineTo(2 * x, y); //arrow of y\n\n  pen.moveTo(x - 7, 7);\n  pen.lineTo(x, 0);\n  pen.moveTo(x + 7, 7);\n  pen.lineTo(x, 0); //arrow of x\n\n  pen.moveTo(2 * x - 7, y - 7);\n  pen.lineTo(2 * x, y);\n  pen.moveTo(2 * x - 7, y + 7);\n  pen.lineTo(2 * x, y);\n  pen.stroke(); //clear a range and set it's transparency\n\n  pen.fillStyle = \"#2f9aff\";\n  pen.globalAlpha = 0.8; //fourth quadrant\n\n  pen.beginPath();\n  pen.rect(x, y - r, r, r);\n  pen.closePath();\n  pen.fill(); //first quadrant\n\n  pen.beginPath();\n  pen.moveTo(x, y);\n  pen.arc(x, y, r / 2, 0.5 * Math.PI, Math.PI);\n  pen.closePath();\n  pen.fill(); //third quadrant\n\n  pen.beginPath();\n  pen.moveTo(x, y);\n  pen.lineTo(x, y - r);\n  pen.lineTo(x - r / 2, y);\n  pen.fill();\n  pen.closePath(); //find R\n  //onx\n\n  const length = 2.5;\n  pen.beginPath();\n  pen.font = \"20px Verdana\";\n  pen.moveTo(x - 3 / 2 * r, y + length);\n  pen.lineTo(x - 3 / 2 * r, y - length);\n  pen.moveTo(x - r, y + length);\n  pen.lineTo(x - r, y - length);\n  pen.moveTo(x - r / 2, y + length);\n  pen.lineTo(x - r / 2, y - length);\n  pen.moveTo(x - r / 2, y + length);\n  pen.lineTo(x - r / 2, y - length);\n  pen.moveTo(x + r / 2, y + length);\n  pen.lineTo(x + r / 2, y - length);\n  pen.moveTo(x + r, y + length);\n  pen.lineTo(x + r, y - length);\n  pen.moveTo(x + 3 / 2 * r, y + length);\n  pen.lineTo(x + 3 / 2 * r, y - length); //ony\n\n  pen.moveTo(x - length, y - r);\n  pen.lineTo(x + length, y - r);\n  pen.moveTo(x - length, y - 1 / 2 * r);\n  pen.lineTo(x + length, y - 1 / 2 * r);\n  pen.moveTo(x - length, y + 1 / 2 * r);\n  pen.lineTo(x + length, y + 1 / 2 * r);\n  pen.moveTo(x - length, y + r);\n  pen.lineTo(x + length, y + r);\n  pen.stroke(); //put R\n\n  pen.fillStyle = \"black\";\n  pen.font = \"15px Verdana\";\n  pen.fillText(-1.5 * R + \"\", x - 1.5 * r - 20, y + 8 * length);\n  pen.fillText(-1 * R + \"\", x - r - 10, y + 8 * length);\n  pen.fillText(-0.5 * R + \"\", x - 0.5 * r - 15, y + 8 * length);\n  pen.fillText(0.5 * R + \"\", x + 0.5 * r - 10, y + 8 * length);\n  pen.fillText(\"0\", x - 10, y + 8 * length);\n  pen.fillText(1 * R + \"\", x + r - 5, y + 8 * length);\n  pen.fillText(1.5 * R + \"\", x + 1.5 * r - 15, y + 8 * length);\n  pen.fillText(R + \"\", x + 8, y - r + 5);\n  pen.fillText(0.5 * R + \"\", x + 8, y - 0.5 * r + 5);\n  pen.fillText(-0.5 * R + \"\", x + 8, y + 0.5 * r + 5);\n  pen.fillText(-R + \"\", x + 8, y + r + 5);\n  pen.stroke();\n  pen.closePath();\n}\n\nfunction clearCanvas(refs) {\n  const x = 175;\n  const y = 150;\n  const rubbish = refs;\n  rubbish.clearRect(0, 0, 2 * x, 2 * y);\n}\n\nfunction drawDots(Dots, refs, R) {\n  const pen = refs;\n  pen.globalAlpha = 1;\n  Dots.forEach((ele, key) => {\n    drawDot(ele, pen, R);\n  });\n} //length of x,y,r\n\n\nfunction drawDot(Dot, pen, R) {\n  pen.beginPath();\n\n  if (Dot.hit) {\n    pen.fillStyle = \"green\";\n  } else {\n    pen.fillStyle = \"red\";\n  }\n\n  let xDraw = translateInputX(Dot.x, R, x, r);\n  let yDraw = translateInputY(Number(Dot.y), R, y, r);\n  pen.arc(xDraw, yDraw, 2, 0, 360, false);\n  pen.fill(); //pen.stroke();\n\n  pen.closePath();\n}\n\nfunction translateInputY(inputY, inputR, coordinateY, coordinateR) {\n  return coordinateY - coordinateR * inputY / inputR;\n}\n\nfunction translateInputX(inputX, inputR, coordinateX, coordinateR) {\n  return coordinateR * inputX / inputR + coordinateX;\n}\n\nfunction translateClickY(browser, eventY, R) {\n  let browserTop = browser.top; //absolute y\n\n  let ay = eventY - browserTop; //coordinate y\n\n  return ((y - ay) * R / r).toFixed(2);\n}\n\nfunction translateClickX(browser, eventX, R) {\n  let browserLeft = browser.left; //absolute x\n\n  let ax = eventX - browserLeft; //coordinate y\n\n  return ((ax - x) * R / r).toFixed(2);\n}\n\nexport const MainGraph = connect(mapStateToProps, mapDispatchToProps)(CanvasGraphComponent);","map":{"version":3,"sources":["/Users/2398768715qq.com/Documents/GitHub/ITMO-PE/ProgramWeb/Lab4temp/demo_front/my-app/src/components/main/mainGraph.jsx"],"names":["React","PropTypes","connect","$","addDot","x","y","r","CanvasGraphComponent","Component","componentDidMount","R","clearCanvas","drawBackground","props","username","window","sessionStorage","getItem","refs","canvas","getContext","componentDidUpdate","prevProps","prevState","snapshot","drawDots","Dots","length","render","clickGraph","event","document","getElementById","getBoundingClientRect","propTypes","number","isRequired","array","func","mapStateToProps","state","dot","mapDispatchToProps","dispatch","browser","cx","translateClickX","clientX","cy","translateClickY","clientY","ajax","url","method","data","X","Y","Password","Username","async","success","res","wrong","alert","message","hit","date","pen","fillStyle","beginPath","clearRect","rect","closePath","fill","strokeStyle","font","strokeRect","moveTo","lineTo","stroke","globalAlpha","arc","Math","PI","fillText","rubbish","forEach","ele","key","drawDot","Dot","xDraw","translateInputX","yDraw","translateInputY","Number","inputY","inputR","coordinateY","coordinateR","inputX","coordinateX","eventY","browserTop","top","ay","toFixed","eventX","browserLeft","left","ax","MainGraph"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport PropTypes from \"prop-types\";\nimport {connect} from \"react-redux\";\nimport $ from \"jquery\";\nimport {addDot} from \"../reduxStore/action/action\";\n\n//pure ui\nconst x = 156;\nconst y = 156;\nconst r = 100;\nclass CanvasGraphComponent extends React.Component {\n    componentDidMount() {\n        const {R,clearCanvas,drawBackground} = this.props;\n        let username = window.sessionStorage.getItem(\"username\");\n        if(!(username===null||username===\"\")) {\n            clearCanvas(this.refs.canvas.getContext(\"2d\"));\n            drawBackground(this.refs.canvas.getContext(\"2d\"), R);\n        }\n    }\n\n    componentDidUpdate(prevProps, prevState, snapshot) {\n        const {R,clearCanvas,drawBackground,drawDots,Dots} = this.props;\n        let username = window.sessionStorage.getItem(\"username\");\n        if(!(username===null||username===\"\")) {\n            clearCanvas(this.refs.canvas.getContext(\"2d\"));\n            drawBackground(this.refs.canvas.getContext(\"2d\"), R);\n            if (Dots.length > 0 || R > 0) {\n                drawDots(Dots, this.refs.canvas.getContext(\"2d\"), R);\n            }\n        }\n    }\n\n    render() {\n        const {clickGraph,R} = this.props;\n        let username = window.sessionStorage.getItem(\"username\");\n        if(username===null||username===\"\"){\n            return (<div> </div>);\n        }\n        return (\n            <canvas ref={\"canvas\"} id={\"click_graph\"} width={312} height={312} onClick={(event)=>{\n            clickGraph(document.getElementById(\"click_graph\").getBoundingClientRect(),event,R);}}/>\n            );\n    }\n}\n\nCanvasGraphComponent.propTypes = {\n    R:PropTypes.number.isRequired,\n    Dots:PropTypes.array.isRequired,\n    drawBackground:PropTypes.func.isRequired,\n    clearCanvas:PropTypes.func.isRequired,\n    drawDots:PropTypes.func.isRequired,\n    clickGraph:PropTypes.func.isRequired\n}\nfunction mapStateToProps(state){\n    return{\n        R:state.dot.R,\n        Dots:state.dot.Dots,\n        }\n}\n//functions won't change state, so here don't use dispatcher and reducer\nfunction mapDispatchToProps(dispatch){\n    return(\n        {\n            drawBackground:(refs,R)=>drawBackground(refs,R),\n            clearCanvas:(refs)=>clearCanvas(refs),\n            drawDots:(Dots,refs,R)=>drawDots(Dots,refs,R),\n            //refs should be this.refs\n            clickGraph:(browser,event,R)=>{\n                let cx = translateClickX(browser,event.clientX,R);\n                let cy = translateClickY(browser,event.clientY,R);\n                $.ajax({\n                    url: \"api/getDot\",\n                    method:\"POST\",\n                    data:{\n                        X:cx,\n                        Y:cy,\n                        R:R,\n                        Password:window.sessionStorage.getItem(\"password\"),\n                        Username:window.sessionStorage.getItem(\"username\")\n                    },\n                    async:false,\n                    success:function (res){\n                        if(res.wrong) {\n                            alert(res.message);\n                        }else {\n                            dispatch(addDot(res.x,res.y+\"\",res.r,res.hit,res.date));\n                            //alert(\"x=\"+res.x+\" y=\"+res.y+\" r=\"+res.r+\" hit=\"+res.hit+\" date=\"+res.date);\n                        }\n                    }\n                })\n            }\n        }\n    )\n}\n\nfunction drawBackground(refs,R){\n    const pen = refs;\n    //background\n    pen.fillStyle = \"white\" ;\n    pen.beginPath();\n    pen.clearRect(0,0,2*x,2*y);\n    pen.rect(0,0,2*x, 2*y);\n    pen.closePath();\n    pen.fill();\n\n    //axis\n    pen.beginPath();\n    pen.strokeStyle = \"black\";\n    pen.font = \"20px Verdana\";\n    pen.strokeRect(0,0,2*x,2*y);\n    //y\n    pen.moveTo(x, 0);\n    pen.lineTo(x, 2*y);\n    //x\n    pen.moveTo(0, y);\n    pen.lineTo(2*x, y);\n    //arrow of y\n    pen.moveTo(x-7,7);\n    pen.lineTo(x,0);\n    pen.moveTo(x+7,7);\n    pen.lineTo(x,0);\n    //arrow of x\n    pen.moveTo(2*x-7,y-7);\n    pen.lineTo(2*x,y);\n    pen.moveTo(2*x-7,y+7);\n    pen.lineTo(2*x,y);\n    pen.stroke();\n\n    //clear a range and set it's transparency\n    pen.fillStyle = \"#2f9aff\";\n    pen.globalAlpha = 0.8;\n\n    //fourth quadrant\n    pen.beginPath();\n    pen.rect(x,y-r,r,r);\n    pen.closePath();\n    pen.fill();\n\n    //first quadrant\n    pen.beginPath();\n    pen.moveTo(x, y);\n    pen.arc(x, y,r/2,0.5 * Math.PI, Math.PI);\n    pen.closePath();\n    pen.fill();\n\n    //third quadrant\n    pen.beginPath();\n    pen.moveTo(x, y);\n    pen.lineTo(x,y-r);\n    pen.lineTo(x-r/2, y);\n    pen.fill();\n    pen.closePath();\n\n    //find R\n    //onx\n    const length = 2.5\n    pen.beginPath();\n    pen.font = \"20px Verdana\";\n    pen.moveTo(x-3/2*r,y+length);\n    pen.lineTo(x-3/2*r,y-length);\n    pen.moveTo(x-r,y+length);\n    pen.lineTo(x-r,y-length);\n    pen.moveTo(x-r/2,y+length);\n    pen.lineTo(x-r/2,y-length);\n    pen.moveTo(x-r/2,y+length);\n    pen.lineTo(x-r/2,y-length);\n    pen.moveTo(x+r/2,y+length);\n    pen.lineTo(x+r/2,y-length);\n    pen.moveTo(x+r,y+length);\n    pen.lineTo(x+r,y-length);\n    pen.moveTo(x+3/2*r,y+length);\n    pen.lineTo(x+3/2*r,y-length);\n    //ony\n    pen.moveTo(x-length,y-r);\n    pen.lineTo(x+length,y-r);\n    pen.moveTo(x-length,y-1/2*r);\n    pen.lineTo(x+length,y-1/2*r);\n    pen.moveTo(x-length,y+1/2*r);\n    pen.lineTo(x+length,y+1/2*r);\n    pen.moveTo(x-length,y+r);\n    pen.lineTo(x+length,y+r);\n    pen.stroke();\n    //put R\n    pen.fillStyle = \"black\";\n    pen.font = \"15px Verdana\";\n    pen.fillText(-1.5*R+\"\", x-1.5*r-20, y+8*length);\n    pen.fillText(-1*R+\"\", x-r-10, y+8*length);\n    pen.fillText(-0.5*R+\"\", x-0.5*r-15, y+8*length);\n    pen.fillText(0.5*R+\"\", x+0.5*r-10, y+8*length);\n    pen.fillText(\"0\", x-10, y+8*length);\n    pen.fillText(1*R+\"\", x+r-5, y+8*length);\n    pen.fillText(1.5*R+\"\", x+1.5*r-15, y+8*length);\n\n    pen.fillText(R+\"\",x+8,y-r+5);\n    pen.fillText(0.5*R+\"\",x+8,y-0.5*r+5);\n    pen.fillText(-0.5*R+\"\",x+8,y+0.5*r+5);\n    pen.fillText(-R+\"\",x+8,y+r+5);\n    pen.stroke();\n    pen.closePath();\n}\nfunction clearCanvas(refs){\n    const x = 175;\n    const y = 150;\n    const rubbish = refs;\n    rubbish.clearRect(0,0,2*x,2*y);\n}\nfunction drawDots(Dots,refs,R){\n    const pen = refs;\n    pen.globalAlpha = 1;\n    Dots.forEach((ele,key)=>{\n        drawDot(ele,pen,R);\n    });\n}\n//length of x,y,r\nfunction drawDot(Dot,pen,R){\n    pen.beginPath()\n    if(Dot.hit){\n        pen.fillStyle = \"green\";\n    }else {\n        pen.fillStyle = \"red\";\n    }\n    let xDraw = translateInputX(Dot.x,R,x,r);\n    let yDraw = translateInputY(Number(Dot.y),R,y,r);\n    pen.arc(xDraw, yDraw, 2, 0,360,false);\n    pen.fill();\n    //pen.stroke();\n    pen.closePath();\n}\nfunction translateInputY(inputY,inputR,coordinateY,coordinateR){\n    return coordinateY-coordinateR*inputY/inputR;\n}\nfunction translateInputX(inputX,inputR,coordinateX,coordinateR){\n    return (coordinateR*inputX/inputR)+coordinateX;\n}\nfunction translateClickY(browser,eventY,R){\n    let browserTop = browser.top;\n    //absolute y\n    let ay = eventY-browserTop;\n    //coordinate y\n    return ((y-ay)*R/r).toFixed(2);\n}\nfunction translateClickX(browser,eventX,R){\n    let browserLeft = browser.left;\n    //absolute x\n    let ax = eventX-browserLeft;\n    //coordinate y\n    return ((ax-x)*R/r).toFixed(2);\n}\n\nexport const MainGraph = connect(mapStateToProps,mapDispatchToProps)(CanvasGraphComponent);"]},"metadata":{},"sourceType":"module"}