{"version":3,"file":"index.cjs","sources":["../src/index.js"],"sourcesContent":["import parser from 'postcss-selector-parser';\n\nconst creator = (/** @type {{ preserve: true | false }} */ opts) => {\n\topts = typeof opts === 'object' && opts || defaultOptions;\n\n\t/** Whether the original rule should be preserved. */\n\tconst shouldPreserve = Boolean('preserve' in opts ? opts.preserve : true);\n\n\treturn {\n\t\tpostcssPlugin: 'css-has-pseudo',\n\t\tRule: (rule, { result }) => {\n\t\t\tif (!rule.selector.includes(':has(')) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet modifiedSelector;\n\n\t\t\ttry {\n\t\t\t\tconst modifiedSelectorAST = parser((selectors) => {\n\t\t\t\t\tselectors.walkPseudos(selector => {\n\t\t\t\t\t\tif (selector.value === ':has' && selector.nodes) {\n\t\t\t\t\t\t\tconst isNotHas = isParentInNotPseudo(selector);\n\n\t\t\t\t\t\t\tselector.value = isNotHas ? ':not-has' : ':has';\n\n\t\t\t\t\t\t\tconst attribute = parser.attribute({\n\t\t\t\t\t\t\t\tattribute: getEscapedCss(String(selector)),\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tif (isNotHas) {\n\t\t\t\t\t\t\t\tselector.parent.parent.replaceWith(attribute);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tselector.replaceWith(attribute);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}).processSync(rule.selector);\n\n\t\t\t\tmodifiedSelector = String(modifiedSelectorAST);\n\t\t\t} catch (_) {\n\t\t\t\trule.warn(result, `Failed to parse selector : ${rule.selector}`);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (typeof modifiedSelector === 'undefined') {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (modifiedSelector === rule.selector) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (shouldPreserve) {\n\t\t\t\trule.cloneBefore({ selector: modifiedSelector });\n\t\t\t} else {\n\t\t\t\trule.assign({ selector: modifiedSelector });\n\t\t\t}\n\t\t},\n\t};\n};\n\ncreator.postcss = true;\n\n/** Default options. */\nconst defaultOptions = { preserve: true };\n\n/** Returns the string as an escaped CSS identifier. */\nconst getEscapedCss = (/** @type {string} */ value) => {\n\tlet out = '';\n\tlet current = '';\n\n\tconst flushCurrent = () => {\n\t\tif (current) {\n\t\t\tconst encoded = encodeURIComponent(current);\n\t\t\tlet encodedCurrent = '';\n\t\t\tlet encodedOut = '';\n\n\t\t\tconst flushEncoded = () => {\n\t\t\t\tif (encodedCurrent) {\n\t\t\t\t\tencodedOut += encodedCurrent;\n\t\t\t\t\tencodedCurrent = '';\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tlet encodedEscaped = false;\n\t\t\tfor (let i = 0; i < encoded.length; i++) {\n\t\t\t\tconst char = encoded[i];\n\n\t\t\t\tif (encodedEscaped) {\n\t\t\t\t\tencodedCurrent += char;\n\t\t\t\t\tencodedEscaped = false;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tswitch (char) {\n\t\t\t\t\tcase '%':\n\t\t\t\t\t\tflushEncoded();\n\t\t\t\t\t\tencodedOut += ( '\\\\' + char );\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\tcase '\\\\':\n\t\t\t\t\t\tencodedCurrent += char;\n\t\t\t\t\t\tencodedEscaped = true;\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tencodedCurrent += char;\n\t\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tflushEncoded();\n\t\t\tout += encodedOut;\n\t\t\tcurrent = '';\n\t\t}\n\t};\n\n\tlet escaped = false;\n\tfor (let i = 0; i < value.length; i++) {\n\t\tconst char = value[i];\n\n\t\tif (escaped) {\n\t\t\tcurrent += char;\n\t\t\tescaped = false;\n\t\t\tcontinue;\n\t\t}\n\n\t\tswitch (char) {\n\t\t\tcase ':':\n\t\t\tcase '[':\n\t\t\tcase ']':\n\t\t\tcase ',':\n\t\t\tcase '(':\n\t\t\tcase ')':\n\t\t\t\tflushCurrent();\n\t\t\t\tout += ( '\\\\' + char );\n\t\t\t\tcontinue;\n\t\t\tcase '\\\\':\n\t\t\t\tcurrent += char;\n\t\t\t\tescaped = true;\n\t\t\t\tcontinue;\n\n\t\t\tdefault:\n\t\t\t\tcurrent += char;\n\t\t\t\tcontinue;\n\t\t}\n\t}\n\n\tflushCurrent();\n\n\treturn out;\n};\n\n/** Returns whether the selector is within a `:not` pseudo-class. */\nconst isParentInNotPseudo = (selector) => selector.parent?.parent?.type === 'pseudo' && selector.parent.parent.value === ':not';\n\nexport default creator;\n"],"names":["creator","opts","defaultOptions","shouldPreserve","Boolean","preserve","postcssPlugin","Rule","rule","result","selector","includes","modifiedSelector","modifiedSelectorAST","parser","selectors","walkPseudos","value","nodes","isNotHas","isParentInNotPseudo","attribute","getEscapedCss","String","parent","replaceWith","processSync","_","warn","cloneBefore","assign","postcss","out","current","flushCurrent","encoded","encodeURIComponent","encodedCurrent","encodedOut","flushEncoded","encodedEscaped","i","length","char","escaped","type"],"mappings":"uIAEMA,EAAqDC,IAC1DA,EAAuB,iBAATA,GAAqBA,GAAQC,QAGrCC,EAAiBC,UAAQ,aAAcH,IAAOA,EAAKI,gBAElD,CACNC,cAAe,iBACfC,KAAM,CAACC,GAAQC,OAAAA,UACTD,EAAKE,SAASC,SAAS,oBAIxBC,YAGGC,EAAsBC,WAAQC,IACnCA,EAAUC,aAAYN,OACE,SAAnBA,EAASO,OAAoBP,EAASQ,MAAO,OAC1CC,EAAWC,EAAoBV,GAErCA,EAASO,MAAQE,EAAW,WAAa,aAEnCE,EAAYP,UAAOO,UAAU,CAClCA,UAAWC,EAAcC,OAAOb,MAG7BS,EACHT,EAASc,OAAOA,OAAOC,YAAYJ,GAEnCX,EAASe,YAAYJ,UAItBK,YAAYlB,EAAKE,UAEpBE,EAAmBW,OAAOV,GACzB,MAAOc,eACRnB,EAAKoB,KAAKnB,EAAS,8BAA6BD,EAAKE,iBAItB,IAArBE,GAIPA,IAAqBJ,EAAKE,WAI1BP,EACHK,EAAKqB,YAAY,CAAEnB,SAAUE,IAE7BJ,EAAKsB,OAAO,CAAEpB,SAAUE,QAM5BZ,EAAQ+B,SAAU,EAGlB,MAAM7B,EAAiB,CAAEG,UAAU,GAG7BiB,EAAuCL,QACxCe,EAAM,GACNC,EAAU,SAERC,EAAe,QAChBD,EAAS,OACNE,EAAUC,mBAAmBH,OAC/BI,EAAiB,GACjBC,EAAa,SAEXC,EAAe,KAChBF,IACHC,GAAcD,EACdA,EAAiB,SAIfG,GAAiB,MAChB,IAAIC,EAAI,EAAGA,EAAIN,EAAQO,OAAQD,IAAK,OAClCE,EAAOR,EAAQM,MAEjBD,EACHH,GAAkBM,EAClBH,GAAiB,cAIVG,OACF,IACJJ,IACAD,GAAgB,KAAOK,eAEnB,KACJN,GAAkBM,EAClBH,GAAiB,mBAIjBH,GAAkBM,YAKrBJ,IACAP,GAAOM,EACPL,EAAU,SAIRW,GAAU,MACT,IAAIH,EAAI,EAAGA,EAAIxB,EAAMyB,OAAQD,IAAK,OAChCE,EAAO1B,EAAMwB,MAEfG,EACHX,GAAWU,EACXC,GAAU,cAIHD,OACF,QACA,QACA,QACA,QACA,QACA,IACJT,IACAF,GAAS,KAAOW,eAEZ,KACJV,GAAWU,EACXC,GAAU,mBAIVX,GAAWU,mBAKdT,IAEOF,GAIFZ,EAAuBV,kBAA+C,qBAAlCA,EAASc,oBAAQA,iBAAQqB,OAAsD,SAAjCnC,EAASc,OAAOA,OAAOP"}