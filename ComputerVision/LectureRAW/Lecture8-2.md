## [MainPage](../../index.md)/[Computer Vision](../README.md)/[Lecture](../Lecture.md)/8-2 RAW

语音识别：Sonix.ai
断句与标点：
翻译：

Для описания работы стереопары нам понадобится специальный математический инструмент. Обычно активные преобразования и процесс формирования изображений описываются с помощью проективной геометрии в однородных координатах. Данный инструмент удобно использовать и для описания принципа работы стереопары. Мы рассматривали уже проективную геометрию в однородных координатах, когда говорили про процесс формирования изображения.

Рассмотрим точки на плоскости в однородных координатах. Они описываются не парой, а тройкой чисел. При этом тройки, полученные друг из друга путем умножения всех компонент вектора на один и тот же скаляр, обозначают одну и ту же точку, а нулевой вектор не соответствует ни одной точке плоскости. При этом точкам проективной плоскости можно сопоставить точки обычной плоскости следующим образом: нужно разделить первые две компоненты на третью, а третью отбросить. Отметим, что такое преобразование имеет смысл только при ненулевой третьей компоненте. Если же третья компонента равна нулю, то данная точка называется точкой на бесконечности, так как третья компонента отвечает за масштабируемость, то есть представляет собой некоторый масштабный коэффициент. Такое преобразование не имеет физического смысла, так как избавиться от масштаба для точки, которая находится бесконечно далеко, невозможно. Поэтому данное преобразование и не имеет смысла.

Отметим, что прямые в однородных координатах также задаются трёхкомпонентным вектором, подобно описанию точек. Описание прямой определено с точностью до ненулевого множителя, а само уравнение прямой имеет вид скалярного произведения вектора, описывающего прямую, на переменную, определяющую каждую точку, принадлежащую данной прямой. Легко догадаться, что данное произведение в уравнении, задающем прямую, равно нулю.

Теперь поговорим о точках пространства с точки зрения однородных координат. Они задаются четверками. При этом, если последняя компонента четверки равна нулю, то точка называется лежащей на бесконечности. 

Также существует преобразование между элементами Евклидова пространства и проективного. То есть, если мы возьмем тройку, описывающую точку в Евклидовом пространстве, и добавим к ней единицу, то получим точку в проективном пространстве, соответствующую ей. Под добавлением единицы подразумевается получение из тройки четверки с помощью добавления еще одной компоненты, равной единице. Отметим также, что точки, лежащие на бесконечности, то есть четверки, у которых последняя компонента равна нулю, не имеют аналогов в Евклидовом пространстве. Все остальные имеют физические аналоги в Евклидовом пространстве, которые, как нетрудно догадаться, получаются делением первых трех компонент четверки на четвертую компоненту и отбрасыванием четвертой компоненты.

Отметим, что и проективные плоскости, и проективные пространства состоят из объектов двух типов: из точек, которые имеют аналоги в Евклидовой нотации, и точек, лежащих на бесконечности. С помощью однородных координат можно задать и проективное преобразование или томографию. Она представляет собой обратимое преобразование проективной плоскости или пространства, которое переводит прямые в прямые. В однородных координатах проективное преобразование выражается в виде квадратной матрицы. При этом каждый вектор, задающий некоторый элемент плоскости или пространства, переходит в соответствующий ему преобразованный вектор путем умножения матрицы преобразования на исходный. 

Используя введенную нотацию, возможно описать преобразование трехмерной сцены в проекцию, получившуюся на матрице цифрового фотоаппарата. Данная модель называется моделью активной камеры. Связанная с ней система координат изображена на слайде, где С — центр камеры, главная ось Х. Большая трехмерного пространства проецируется в точку X на плоскости изображения. Активная камера определяется центром камеры, главной осью, то есть лучом, начинающимся в центре камеры и направленным туда, куда камера смотрит, а также плоскостью изображения, то есть плоскостью, на которую выполняется проецирование точек, и системой координат на этой плоскости.

В такой модели произвольная точка пространства проецируется на плоскость изображения в точку, лежащую на отрезке, который соединяет центр камеры с исходной точкой пространства. Теперь, используя проективную геометрию и нотацию однородных координат, рассмотрим устройство активной камеры. Формула проецирования имеет простую математическую запись в однородных координатах и представлена на слайде, где X — однородные координаты точки пространства, X — однородные координаты точки плоскости, N — матрица размера три на четыре, также называемая матрицей камеры. Матрица N выражается образом, представленным на слайде, где K — верхняя треугольная матрица внутренних параметров, имеющая размер три на три, R — матрица размера три на три, определяющая поворот камеры относительно глобальной системы координат, и единичная матрица размера три на три и C — вектор, содержащий координаты центра камеры. Стоит отметить, что матрица камеры определена с точностью до постоянного ненулевого множителя, который не изменит результаты проецирования точек. Однако этот постоянный множитель обычно выбирается так, чтобы матрица камеры имела вышеописанный вид. 

В самом простом случае, когда центр камеры лежит в начале координат, главная ось камеры направлена на ось координат, на плоскости камеры имеют одинаковый масштаб, что эквивалентно случаю квадратных пикселей, а центр изображения имеет нулевые координаты. Тогда матрица камеры будет иметь вид произведения матрицы K на матрицу, составленную из единичной матрицы и нулевого столбца. У реальных камер пиксели обычно незначительно отличаются от квадратных, а центр изображения имеет ненулевые координаты. В таком случае матрица внутренних параметров имеет вид, представленный на слайде. Коэффициенты X и Y называются фокусными расстояниями камеры, причем F называется фокусным расстоянием, а X и Y — фокусные расстояния вдоль соответствующих осей.

Помимо этого, в силу нереальности оптики на изображениях, полученных с камер, присутствуют искажения дисперсии. Данные искажения имеют нелинейную математическую нотацию в терминах однородных координат. Здесь K1, K2, P1, N1, P2 и K3 — это коэффициенты, являющиеся параметрами оптической системы. X' и Y' — координаты проекции точки относительно центра изображения при квадратных пикселях и отсутствии искажений. X2' и Y2' — искаженные координаты точки относительно центра изображения при квадратных пикселях. Искажения не зависят от расстояния до объекта, а зависят только от координат точек, в которых проецируются пиксели объекта. Соответственно, для компенсации дисперсии обычно выполняется преобразование исходного изображения, полученного с камеры. Это преобразование будет одним и тем же для всех изображений, полученных с камеры, при условии постоянства фокусного расстояния, то есть одной и той же матрицы внутренних параметров калибровки. В ситуации, когда известны внутренние параметры калибровки и коэффициенты дисперсии, говорят, что камера откалибрована.

После того как мы поговорили про общую теорию проецирования в терминах однородных координат, перейдем к аппаратуре, специфической для стереозрения. Для описания работы стереопары нам понадобится и проективная геометрия. Перед тем как перейти к описанию метода вычисления трехмерных координат точек, опишем некоторые важные геометрические свойства, связывающие положение проекций точки трехмерного пространства на изображение обеих камер. Пусть имеются две камеры, как показано на слайде: С — центр первой камеры, С' — центр второй камеры. Точка пространства X проецируется в точку X на плоскости изображения левой камеры и в точку X' на плоскости изображения правой камеры. 

Прообразом точки X на изображении левой камеры является луч X - X. Этот луч проецируется на плоскость второй камеры в прямую и штрих, называемую эпиполярной линией. Образ точки X на плоскости изображения второй камеры обязательно лежит на эпиполярной линии и штрих. Таким образом, каждой точке X на изображении левой камеры соответствует эпиполярная линия и штрих на изображении