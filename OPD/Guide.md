## [MainPage](../index.md)/[OPD](README.md)/Guide

# <center>Приложение В. Состав, структура и функционирование БЭВМ-NG <br>附录 C. BEVM-NG 的组成、结构和功能</center>

## <center>Часть 1. Базовая ЭВМ <br>第 1 部分：基础计算机</center>

### 1.1 Назначение базовой ЭВМ 基础计算机的用途

Базовая ЭВМ - это простая гипотетическая машина, обладающая типичными чертами многих конкретных ЭВМ. Знание принципов построения и функционирования этой ЭВМ является хорошей базой для освоения микропроцессорных систем любых типов и моделей, поэтому она названа базовой ЭВМ. Естественно, начинать изучение ЭВМ целесообразно с подобной машины низкого уровня, что можно делать практически, используя ее модели, построенные для разных типов персональных ЭВМ. При построении базовой ЭВМ за прототип выбраны ЭВМ "Электроника 100" и "Саратов", а также схожие с ними ЭВМ типа PDP- 8, однокристальный микропроцессор IM6100 и персональная ЭВМ DECmate 11. В новую версию БЭВМ-NG вошли некоторые элементы архитектуры PDP-11.  
基础计算机是一个简单的假设机器，具有许多特定计算机的典型特征。了解这台计算机的构造和操作原理是掌握任何类型和型号的微处理器系统的良好基础，因此它被称为基础计算机。自然，建议使用类似的低级机器开始研究计算机，这实际上可以使用为不同类型的个人计算机构建的模型来完成。在构建基础计算机时，选择 Elektronika 100 和 Saratov 计算机，以及与之类似的 PDP-8 计算机、IM6100 单片微处理器和 DECmate 11 个人计算机作为原型。被包含在新版本的 BEVM-NG 中。

### 1.2 Структура базовой ЭВМ 基础计算机的结构

На рис. В.1 приведена упрощенная структура базовой ЭВМ. Это одноадресная ЭВМ аккумуляторного типа, выполняющая простейшие операции с 16-разрядными машинными словами.  
图上。 B.1 显示了基础计算机的简化结构。 这是一个单地址电池型计算机，可以使用 16 位机器字执行简单的操作。

<div align=center><img src="pic/Guide/Guide_C.1.png"></div>
<center>Рисунок В. 1 Модель базовой ЭВМ<br>图 B.1 基本计算机模型</center>

БЭВМ-NG включает в себя нескольких функциональных блоков и регистров:  
BEVM-NG 包括几个功能块和寄存器：

Память. Состоит из 2048 ячеек (16-битовых) с адресами 0, 1, ..., 2046, 2047. Ячейки с 0 по OxF имеют специальное назначение, в них хранятся вектора прерываний, которые будут рассмотрены далее.  
内存：它由地址为 0, 1....,2046,2047 的 2048 个单元（16 位）组成。单元 0 到 OxF 有一个特殊用途，它们存储中断向量，稍后将讨论。

Процессор. Состоит из ряда регистров, арифметико-логического устройства с коммутатором и блоком установки признаков результата, а также устройства управления.  
中央处理器。 它由多个寄存器、一个带开关的算术逻辑单元和一个用于设置结果符号的块以及一个控制装置组成。

- Устройство управления (УУ, CU - Control Unit), его также называют микропрограммным устройством (МПУ), выполняет машинные команды процессора при помощи элементарных микроопераций: открытия вентилей и проверкой состояния бита заданного регистра. Работа МПУ разбита на циклы или стадии  исполнения команды и циклы пультовых операций. Подробно МПУ будет рассмотрено далее.  
  控制单元 (УУ, CU - Control Unit)，也称为微程序设备 (MCU)，使用基本的微操作执行处理器机器指令：打开门并检查给定寄存器的某个位的状态。 MCU 的工作分为命令执行的周期或阶段和控制台操作的周期。 稍后将详细讨论 MPA。

- Арифметико-логическое устройство (АЛУ, ALU - Arithmetic-n-Logic Unit) может выполнять арифметические операции, такие как сложение и сложение с учетом переноса, полученного в результате выполнения предыдущей операции, операции логического умножения и инвертирования. Выход из АЛУ подключен к коммутатору.  
  算术逻辑单元（ALU，ALU-Arithmetic-n-Logic Unit）可以执行加法和加法等算术运算，同时考虑到前次运算产生的进位、逻辑乘法和求逆运算。 ALU 的输出连接到开关。

- Коммутатор это устройство, на которое поступают 18 разрядов результата операции из АЛУ (16-ти разрядный результат сложения и биты, необходимые для формирования признака переноса С), а также предыдущее значение переноса из регистра состояния. Коммутатор выполняет операции прямой и перекрестной передачи информации между байтами слова, осуществления арифметических и циклических побитовых сдвигов влево и вправо, а также для расширения знака младшего байта в старший байт. Информация из коммутатора поступает на шину данных для записи в регистры БЭВМ и на блок установки признаков результата.  
  开关是一个设备，它接收来自 ALU 的 18 位运算结果（加法的 16 位结果和形成进位标志 C 所需的位），以及来自状态寄存器的前一个进位值.开关执行字的字节之间的直接和交叉信息传输操作，执行算术和循环移位左右，以及将低字节的符号扩展到高字节。来自开关的信息被发送到数据总线以写入计算机寄存器和块以设置结果的符号。

  Блок установки признаков результата предназначен для формирования однобитовых признаков результата, которые в конечном итоге сохраняются в младших 4-х битах регистра состояния. К ним относятся:  
  结果标志设置块旨在生成一位结果标志，最终存储在状态寄存器的低 4 位中。 这些包括：

  - Флаг переноса (С - Carry) выступает в качестве продолжения аккумулятора и заполняется при выходе результата за границу 16-ти разрядного слова. При выполнении арифметических операций и операций сдвига в него попадает выход Cnew коммутатора. Флаг переноса необходимо контролировать при выполнении арифметических операций с беззнаковыми числами.  
    进位标志 (C - Carry) 作为累加器的延续，当结果超出 16 位字边界时被填充。当执行算术和移位操作时，开关的输出 Cnew 进入它。对无符号数执行算术运算时，必须控制进位标志。

  - Флаг переполнения (V — overflow) сигнализирует о переполнении разрядной сетки при операциях АЛУ со знаковыми числами, и формируется как операция сложения по модулю 2 поразрядных переносов из 14 в 15 разряд и из 15 в 16 разряд АЛУ, т.е. на выходе коммутатора осуществляется операция V = C14 ⊕ Cnew.  
    溢出标志 (V-overflow) 在 ALU 操作期间用带符号数表示位网格的溢出，并形成为从 ALU 的第 14 位到第 15 位和从第 15 位到第 16 位的按位传输的模 2 加法运算，即在换向器输出端，执行 V = C14 ⊕ Cnew 操作。

  - Флаг нуля (Z - Zero) сохраняет информацию о том, равно ли содержимое аккумулятора нулю, заполняется при выполнении операций над аккумулятором.  
    零标志（Z - Zero）存储有关累加器内容是否为零的信息，在对累加器执行操作时填充。

  - Флаг знака (N - Negative) сохраняет знак числа в аккумуляторе, фактически дублируя его 15-й разряд.  
    符号标志（N - Negative）保留累加器中数字的符号，有效地复制其第 15 位。

Регистр 寄存器：
- Аккумулятор (АС - Accumulator) — 16-ти разрядный регистр, являющийся одним из главных элементов процессоров аккумуляторного типа. Машина может одновременно выполнять операции только с одним или двумя операндами, которые находятся на левом или правом входе АЛУ. Результаты арифметико-логических операций обычно помещаются в АС и изменяются соответствующим образом признаки результата.  
累加器（AC-Accumulator）——一个16位的寄存器，是电池型处理器的主要元件之一。 机器只能同时对 ALU 左侧或右侧输入的一个或两个操作数执行操作。 算术逻辑运算的结果通常放在 AS 中，结果的特性会相应改变。

- Счетчик команд (IP - Instruction Pointer) — регистр, который хранит адрес ячейки памяти, содержащей следующую исполняемую команду программы. Так как команды могут размещаться в любой из 2048 = 211 ячеек памяти, то IP имеет 11 разрядов.  
  指令指针 (IP) 是一个寄存器，用于存储包含下一条可执行程序指令的内存位置的地址。 由于命令可以放置在 2048 = 211 个存储单元中的任何一个中，因此 IP 有 11 位。

- Регистр адреса (AR - Address Register) — 11-ти разрядный регистр, служит для организации обращений к ячейкам памяти и содержит адрес ячейки памяти, к которой обращается процессор.  
  地址寄存器（AR - Address Register）是一个 11 位的寄存器，用于组织对存储单元的访问，并包含处理器访问的存储单元的地址。

- Регистр данных (DR - Data Register) — 16-ти разрядный регистр для временного хранения 16-разрядных слов при обмене информацией между памятью и процессором.  
  数据寄存器（DR - Data Register） - 一个 16 位寄存器，用于在存储器和处理器之间交换信息期间临时存储 16 位字。

- Регистр команд (CR - Command Register) — 16-ти разрядный регистр, используемый для хранения кода выполняемой в данный момент команды с целью ее поэтапного декодирования и выполнения требуемых операций.  
  命令寄存器（CR - Command Register）是一个 16 位的寄存器，用于存储当前正在执行的命令的代码，以便逐步对其进行解码并执行所需的操作。

- Буферный регистр (BR - Buffer Register) это 16-ти разрядный регистр, который используется для организации промежуточного хранения данных во время работы.  
  缓冲寄存器（BR——Buffer Register）是一个 16 位的寄存器，用于在操作过程中组织中间数据存储。

- Указатель стека (SP - Stack Pointer), как и IP и AR 11-ти разрядный, и всегда указывает на вершину стека - особого участка памяти, который предназначен для хранения адресов возвратов и параметров подпрограмм и прерываний.  
  堆栈指针（SP - Stack Pointer）与 IP 和 AR 一样，都是 11 位的，并且始终指向堆栈的顶部 - 一个特殊的内存区域，旨在存储子程序和中断的返回地址和参数。

- Клавишный регистр (IR - Input Register) - 16-разрядный регистр, находится в  составе пульта оператора ЭВМ и предназначен для ввода адреса программы, кодов программы и данных. Пульт оператора одержит набор тумблеров и клавиш, позволяющих оператору осуществлять ввод данных в БЭВМ, запуск программы на выполнение и управление режимами работы БЭВМ.  
  密钥寄存器（IR - Input Register）——16位寄存器，是计算机操作员控制台的一部分，用于输入程序地址、程序代码和数据。 操作员控制台包含一组拨动开关和按键，允许操作员将数据输入计算机，启动程序以执行并控制计算机的操作模式。

- Регистр состояния (PS - Program State) - 16-разрядный регистр, хранит биты управляющие работой БЭВМ (работа, прерывание и пр.) и признаки результата. В актуальной программной реализации используются только 9 младших разрядов.  
  状态寄存器（PS - Program State）是一个 16 位的寄存器，存储控制计算机操作（工作、中断等）的位和结果的标志。 在当前的软件实现中，仅使用了 9 个最低有效位。

### 1.3 Система команд базовой ЭВМ 基础计算机的指令系统

### 1.4.1 Представление данных в БЭВМ 基础计算机中数据的表示

### 1.4.2 Представление чисел в БЭВМ 基础计算机中数字的表示

### 1.5 Операции с памятью и арифметические операции 内存运算和算术运算

### 1.6 Сдвиги и логические операции Сдвиги и логические операции

### 1.7 Управление вычислительным процессом 计算过程控制

### 1.8 Подпрограммы и стек 子程序和堆栈

Достаточно часто встречаются ситуации, когда отдельные части программы должны выполнить одни и те же действия по обработке данных (например, вычисление функции). В подобных случаях повторяющиеся части программы выделяют в подпрограмму, а в соответствующие места программы заносят лишь команды обращения к этой подпрограмме. В базовой ЭВМ для этой цели используется команда `CALL` (вызов подпрограммы). На рис. В.6 показана часть основной программы, содержащая две команды `CALL 300`, с помощью которых осуществляется переход к выполнению команд подпрограммы.  
在某些情况下，程序的不同部分必须执行相同的数据处理操作（例如，函数的计算）。在这种情况下，程序的重复部分被分成一个子程序，只有调用这个子程序的指令被输入到程序的适当位置。为此，基础计算机使用 `CALL` 命令（子程序调用）。图 B.6 显示了主程序的一部分，包含两个 `CALL 300` 命令，借助该命令可以执行子程序的命令转换。

<div align=center><img src="pic/Guide/Guide_C.6.png"></div>
<center>Рисунок В. 6. Обращение к подпрограмме и возврат из нее<br>图 B. 6 从子程序调用和返回</center>

Подпрограммы осуществляют запись адресов возврата в структуру данных, которая называется стек. Стек работает по принципу «первым вошел — последним вышел» и его можно представить, как стопку книг, где вам видна только верхняя книга. В базовой ЭВМ стек организован при помощи специального регистра — указателя стека (ЗВ), который изначально сброшен в значение 0, и так как SP 11-ти разрядный, то первый элемент стека имеет адрес 7FF, следующий 7FE, т.е. растет от старших адресов к младшим.  
子例程将返回地址写入称为堆栈的数据结构。 堆栈以先进后出的方式工作，可以被认为是一堆书，您只能看到最上面的书。 在基础计算机中，堆栈使用特殊寄存器 - 堆栈指针 (ST) 进行组织，该寄存器最初重置为 0，并且由于 SP 是 11 位，因此第一个堆栈元素的地址为 7FF，下一个为 7FE，即 从较高的地址增长到较低的地址。

По команде `CALL 300`, расположенной в ячейке 25 (см. рис В.6), выполняется запись адреса возврата 25 + 1 = 26 (значение счетчика команд после цикла выборки команды) на вершину стека. Для этого сначала уменьшается указатель стека на 1, и производится запись в ячейку памяти, на которую указывает SP. Если стек пуст, как в нашем случае, то это ячейка 7FF. Для перехода к подпрограмме производится запись аргумента команды `CALL` (прямого абсолютного адреса 300) в счетчик команд (адрес первой команды подпрограммы).  
位于单元 25 中的 `CALL 300` 命令（参见图 B.6）将返回地址 25 + 1 = 26（取指周期后程序计数器的值）写入堆栈顶部。 为此，堆栈指针首先减 1，然后写入 SP 指向的内存位置。 如果堆栈是空的，就像我们的例子一样，那么这是单元格 7FF。 要跳转到子程序，将 `CALL` 命令的参数（直接绝对地址 300）写入程序计数器（子程序第一条指令的地址）。

Далее начинается процесс выполнения команд подпрограммы, который завершается командой `RET`, расположенной в ячейке 326. Эта команда выхода из подпрограммы предписывает ЭВМ выполнить переход к команде, расположенной по адресу, сохраненному в текущей ячейке указателя стека (7FF). Так как в эту ячейку ранее было записано число 26, то будет исполняться команда, находящаяся в ячейке 26, т.е. следующая за обращением к подпрограмме. Аналогично выполняется команда `CALL 300`, расположенная в ячейке 72 (после выполнения команд подпрограммы будет выполнен переход к ячейке 73).  
接下来，执行子程序指令的过程开始，以位于单元 326 中的 `RET` 指令结束。该子程序退出指令指示计算机跳转到位于当前堆栈指针位置 (7FF) 中存储的地址的指令.由于数字 26 先前已写入此单元格，因此将执行位于单元格 26 中的命令，即在调用子程序之后。类似地，执行位于单元 72 中的 `CALL 300` 命令（在执行子程序命令之后，将转换到单元 73）。

Положить на стек значение из аккумулятора в БЭВМ можно при помощи команды `PUSH`, которая сначала уменьшает текущее значение указателя стека на 1, а потом по адресу, получившемуся в SP записывает значение АС.  
您可以使用 `PUSH` 命令将计算机中累加器中的一个值放入堆栈，该命令首先将堆栈指针的当前值减 1，然后将 AC 的值写入 SP 中获得的地址。

Операция снятия со стека `POP` действует противоположным образом - сначала по адресу, содержащемуся в SP читает значение из памяти, а потом увеличивает значение SP=SP+1. Для удобства программиста в БЭВМ определена операция обмена вершины стека с АС — `SWAP`.  
`POP` 弹出操作以相反的方式工作 - 首先，它从内存中包含 SP 的地址处读取值，然后递增 SP=SP+1 的值。 为了程序员的方便，计算机定义了与 AC 交换栈顶的操作——`SWAP`。

В стеке могут размещаться не только адрес возврата из подпрограммы, но и передаваемые подпрограмме параметры и возвращаемый результат. Перед вызовом подпрограммы по команде `CALL` в стеке размещается заданное количество параметров, которые помещаются в стек командами push. После возврата из подпрограммы стек должен быть приведен в исходное состояние, из него должны быть прочитаны результаты подпрограммы, а указатель стека должен быть возвращен в состояние до первой команды push. В БЭВМ для этого предназначена команда `POP`.  
堆栈不仅可以包含子程序的返回地址，还可以包含传递给子程序的参数和返回结果。 在用`CALL`命令调用子程序之前，将指定数量的参数放入堆栈，这些参数通过push命令放入堆栈。 子程序返回后，堆栈必须复位，从其中读取子程序的结果，堆栈指针必须返回到第一次push之前的状态。 在计算机中，“POP”命令就是为此而设计的。

Доступ к переданным в стеке параметрам и формирование результатов в БЭВМ из подпрограммы производится при помощи специального режима адресации — со смещением относительно SP. При этом загрузка самого верхнего параметра (который мы положили самым последним перед вызовом `CALL`) будет иметь смещение 1. Смещение 0 указывает на адрес возврата из подпрограммы, который в момент входа в подпрограмму лежит на вершине стека. Следует заметить, что передавать параметры подпрограмме и получать результаты можно не только через стек, а и через регистры общего назначения. В БЭВМ такой регистр один - АС.  
访问堆栈上传递的参数并从子程序在计算机中形成结果是使用特殊寻址模式执行的 - 具有相对于 SP 的偏移量。在这种情况下，最顶层参数的加载（我们在调用 `CALL` 之前放置最后一个参数）将具有偏移量 1。偏移量 0 表示来自子程序的返回地址，在进入子程序时位于顶部的堆栈。需要注意的是，不仅可以通过堆栈，也可以通过通用寄存器将参数传递给子程序并接收结果。计算机中只有一个这样的寄存器——AS。

### 1.9 Выполнение машинных команд 机器指令的执行

## <center>Часть 2. Организация ввода-вывода в базовой ЭВМ <br> 第 2 部分：基础计算机中输入输出的组织</center>

Обмен информацией с внешним устройством состоит из **инициации обмена**, где осуществляются предварительные действия по подготовке к вводу или выводу данных (установка соединения, ожидание готовности и пр.) и собственно **обмена банными** (их передачей или приемом).  
与外部设备的信息交换包括 **交换的启动**，其中执行初步操作以准备数据的输入或输出（建立连接、等待准备就绪等）和实际的 **数据交换**（它们的传输或接收）。

Если и инициацией и обменом занимается центральный процессор, то такой обмен называется **проераммно-управляеммм**. Программно-управляемый обмен по способу инициации разделяется на **синхронным**, когда обмен начинается в заранее известный промежуток времени (например, каждую минуту) и **асинхронным**, когда программе неизвестно время начала обмена данными и она вынуждена периодически проверять возможность обмена (например, готовность внешнего устройства).  
如果启动和交换都由中央处理器处理，则这种交换称为 **程序控制**。当交换以预定的时间间隔（例如，每分钟）开始时，程序控制的交换按启动的方法分为 **同步** 的。当程序不知道数据交换的开始时间，是 **异步** 的。程序需要定期检查交换的可能性（例如，外部设备的准备情况）。

Чтобы исключить периодическую проверку готовности, устройства могут сами инициировать обмен по специальному аппаратному сигналу, который называется **запрос прерывания**, а соответствующий обмен — **управляемый прерываниями ввод-вывод**. При таком способе внешнее устройство сигнализирует процессору о необходимости начать обмен, процессор приостанавливает (**прерывает**) текущую программу, осуществляет ввод-вывод с помощью **npoграммы обработки прерывания**, а затем продолжает выполнять основную программу.  
为了消除周期性的就绪检查，设备可以自己发起一个特殊的硬件信号的交换，称为 **中断请求**，相应的交换是**中断驱动的 I/O**。 使用这种方法，外部设备向处理器发出信号以开始交换，处理器暂停（**中断**）当前程序，使用**中断处理程序**执行 I/O，然后继续执行主程序。
 
**Ввод-вывод с использованием прямого доступа к памяти** (ПДП, в английской литературе DMA) организует и инициацию и обмен данными при помощи контроллеров ПДП. Такие контроллеры передают данные непосредственно в память ЭВМ, при этом центральный процессор в обмене данными не участвует.  
**使用直接内存访问的输入-输出**（ПДП，英文文献中的 DMA）使用 ПДП 控制器组织启动和数据交换。 这种控制器直接将数据传输到计算机内存，而中央处理器不参与数据交换。

Обмен данными (прием и передача) может также быть организован **синхронно**, когда наличие данных на шине подтверждается специальным сигналом синхронизации с постоянной частотой, и **асинхронно**, с использованием сигналов готовности "и/или" подтверждения приема-передачи данных.  
数据交换（接收和传输）可以 **同步** 组织，当总线上的数据存在通过具有恒定频率的特殊同步信号来确认时。也可以 **异步** 地，使用就绪信号 “和/或” 确认数据的传输和接收

Задачу инициации и обмена данными в ЭВМ осуществляют специальные программы (такие программы еще называют драйверами), которые совместно с аппаратурой ЭВМ организуют и контролируют процесс ввода-вывода.
计算机中启动和交换数据的任务是由特殊程序（此类程序也称为驱动程序）执行的，这些程序与计算机硬件一起组织和控制输入输出过程

### 2.1 Устройства ввода-вывода базовой ЭВМ 主机的 I/O 设备

<div align=center><img src="pic/Guide/Guide_C.11.png"></div>
<center>Рисунок В.11 Подсистема ввода-вывода базовой ЭВМ(показаны КВУ и ВУ1,3)<br>图 B.11 基础计算机的 I/O 子系统（显示了 КВУ 和 ВУ1,3）</center>

Модель базовой ЭВМ с контроллерами устройств ввода-вывода представлена на рис В.11. В базовой ЭВМ используются простейшие внешние устройства (ВУ): устройство вывода (ВУ-1), устройства ввода ВУ-2 и устройство ввода-вывода ВУ-3. В модели устройства ввода-вывода представлены 8-разрядными регистрами данных (РД ВУ). Через регистры данных ВУ-2 и ВУ-3 информация может быть введена в базовую ЭВМ, а в регистры данных ВУ-1 и ВУ-3 принята из базовой ЭВМ.  
带有 I/O 设备控制器的基本计算机模型如图 B.11 所示。 基本计算机使用最简单的外部设备（ВУ）：输出设备（ВУ-1）、输入设备 ВУ-2 和输入-输出设备 ВУ-3。 在该模型中，输入输出设备由 8 位数据寄存器 (РД ВУ) 表示。 通过数据寄存器 ВУ-2 和 ВУ-3，可以将信息输入到基础计算机，并输入从基础计算机接收的数据寄存器 ВУ-1 和 ВУ-3。

Кроме того, в последней версии БЭВМ реализован таймер (устройство ВУ-0), которое вызывает прерывание через заданное в его DR число секунд; устройство ввода-вывода ВУ-4, аналогичное с ВУ-3, за исключением того, что используются отдельные регистры для входных и выходных данных; текстовый принтер ВУ-5; бегущая строка ВУ-6; 8-ми разрядный 7-сегментный индикатор ВУ-7; клавиатура ВУ- 8 и цифровая клавиатура ВУ-9.  
此外，在最新版本的计算机中，实现了一个计时器（ВУ-0 设备），它会在其 DR 中指定的秒数后导致中断； 输入输出设备ВУ-4，类似于ВУ-3，不同之处在于输入和输出数据使用单独的寄存器； 文本打印机 ВУ-5； 运行线 ВУ-6； 8位7段指示器ВУ-7； 键盘 ВУ-8 和数字键盘 ВУ-9。

Между ВУ и процессором включены простейшие контроллеры внешнего устройства (КВУ), каждый из которых содержит:  
在 ВУ 和处理器之间，包括最简单的外部设备控制器 (КВУ)，每个控制器都包含：

- **дешифратор адреса**, позволяющий выделить обращение к данному ВУ среди всех обращений к устройствам ввода-вывода, подключенных к процессору;  
  **地址解码器**，允许您在对连接到处理器的 I/O 设备的所有调用中选择对该 ВУ 的调用；
- **логику управления КВУ**. набор логических схем, позволяющий реагировать и формировать сигналы шины БЭВМ. Данные схемы не представлены подробно для КВУ-3, в качестве примера реализации необходимо обратится к схеме КВУ-1 на рис. В.11;  
  **КВУ 逻辑控制**，一组逻辑电路，允许您响应和生成计算机总线信号。 这些方案对于 КВУ-3 没有详细介绍；作为实现示例，有必要参考图 B.11 中的 КВУ-1 方案；
- **регистр данных** (DR - Data Register), через который происходит обмен данными между процессором и внешним устройством;  
  **数据寄存器**（DR - Data Register），通过它在处理器和外部设备之间交换数据；
- **регистр состояния** (SR - State Register), в котором хранится информация о готовности ВУ к обмену данными с процессором. В контроллерах простейших ВУ используются однобитовые регистры готовности, которые часто называют **флагом**.  
  **状态寄存器**（SR - State Register），它存储有关 ВУ 准备好与处理器进行数据交换的信息。 在最简单的 ВУ 的控制器中，使用了一位就绪寄存器，通常称为**标志**。
- **регистр управления** (MR - Management Register), регистр, в котором используются 4 младших разряда, разряд 3 - для разрешения прерывания от контроллера и разряды с 0 по 2, которые содержат номер вектора прерывания. Если прерывания разрешены командой `EI` и установлено разрешение прерывания от контроллера (разряд 3), то контроллер будет генерировать сигнал IntRq и выставлять номер вектора прерывания на шину адреса.  
  **管理寄存器**（MR - 管理寄存器），一个使用 4 个最低有效位的寄存器，位 3 - 启用来自控制器的中断，位 0 到 2，其中包含中断向量的编号。 如果使用 `EI` 命令启用中断并且设置了控制器中断启用（位 3），则控制器将生成 IntRq 信号并将中断向量编号设置到地址总线。

Контроллеры ВУ связаны с процессором при помощи **системной шины** БЭВМ, в сегменты (или, физически, разъемы для установки контроллеров) которой подсоединяются различные шины со стороны процессора и контроллера:  
ВУ 控制器使用计算机的 **系统总线** 连接到处理器，连接到从处理器和控制器一侧连接各种总线的段（或物理上用于安装控制器的连接器）：

- **шина данных** (Data0..7), по которым происходит передача данных в процессор или из процессора;  
  **数据总线**（Data0..7），数据通过它传输到处理器或从处理器传输；
- **шина адреса** (Addr0..7), по которой передается адрес внешнего устройства от процессора к КВУ и номер вектора запроса на прерывание (Int#) от КВУ к процессору, подтверждаемый сигналом выдачи вектора (IntV);  
  **地址总线**（Addr0..7），通过该总线将外部设备的地址从处理器传送到 КВУ 和从 КВУ 到处理器的中断请求向量（Int#）的编号，由向量输出信号确认（IntV）；
- **сигнал запроса прерывания** (IntRq), по которому выставляется требование прерывания от внешнего устройства;  
  **中断请求信号**（IntRq），它设置来自外部设备的中断请求；
- **сигнал ввода** (Input) - для передачи приказа на ввод (`IN #reg`);  
  **输入信号**（Input） - 发送输入指令（`IN #reg`）；
- **сигнал вывода** (Output) - для передачи приказа на вывод (`OUT #reg`);  
  **输出信号**（Output） - 发送输出命令（`OUT #reg`）；
- **начальный сигнал предоставления прерывания** (IntSC), который управляется программно микрокодом в цикле прерывания по микрокоманде `INTs`.  
  **中断授权开始信号**（IntSC），在`INTs`微指令中断周期由软件微码控制。
- **входящий цепочный сигнал предоставления прерывания** (IntSCi# - Interrupt Supply Chain input), по которому контоллер, в соответствии с порядком подключения к шине, проверяет возможность предоставления ему прерывания в соответствии с очередью подключения, и генерирует прерывание, если они разрешены глобально командой `EI` и в регистре MR контроллера;  
  **传入的中断供应链信号**（IntSCi# - 中断供应链输入），根据该信号，控制器按照连接到总线的顺序，根据连接队列检查是否授予其中断，以及如果它们由 `EI` 命令全局启用并在寄存器 MR 控制器中启用，则生成中断；
- **исходящий цепочный сигнал предоставления прерывания** (IntSCo# - Interrupt Supply Chain output), который передает контроллер по шине далее следующему КВУ, если нет необходимости вызвать прерывание вычислительного процесса;  
  **输出中断供应链信号**（IntSCo# - 中断供应链输出），如果不需要在计算过程中引起中断，它将控制器通过总线转移到下一个 КВУ；
- **сигнал готовности** (Rdy), подтверждающий завершение операции ввода- вывода внутри цикла обмена между АС и DR соответствующего КВУ. В случае операции ввода Rdy подтверждает данные, передаваемы по шине данных, и в обоих случаях операции ввода-вывода сигнализирует о том, что цикл обмена с регистром данных DR контроллера завершен;  
  **就绪信号**（Rdy），确认对应 КВУ 的 AC 和 DR 之间的交换周期内 I/O 操作完成。 在输入操作的情况下，Rdy确认数据总线上传输的数据，并且在两种 I/O 操作的情况下都发出与控制器的数据寄存器 DR 的交换周期完成的信号；
- **сигнал синхронизации** (Syn) от тактового генератора БЭВМ, который задает временной слот единичного обмена по шине БЭВМ.  
  来自计算机时钟发生器的 **同步信号** (Syn)，它设置计算机总线上单个交换的时隙。

Со стороны процессора к системной шине БЭВМ подключены:  
在处理器端，以下连接到计算机的系统总线：

- **дешифратор приказа** (DC IO), который преобразует приказ в КОП команды ввода-вывода в набор управляющих сигналов на шине. 0-й выход дешифратора активен после команды `DI`; 1 - для `EI`; 2 - для команды `IN`, формируя на шине БЭВМ сигнал Input; 3 — для команды `OUT` и сигнала Output.  
  **指令解码器**（DC IO），它将 I/O 命令的 CPC 指令转换成总线上的一组控制信号。 `DI` 命令后解码器输出 0 有效； 1 - 用于指令 `EI`; 2 - 用于指令 `IN`，形成计算机总线上的输入信号； 3 - 用于 `OUT` 命令和输出信号。
  Выходы, начиная с 4-го не используются;  
  不使用从第 4 个开始的输出；

- **регистр разрешения прерывания**, который входит в состав PS 5-ым разрядом, и показывает глобальный статус разрешений прерывания в процессоре;  
  **中断使能寄存器**，是 PS 位 5 的一部分，指示处理器中的全局中断使能状态；
- **регистр прерывания от КВУ**. по которому выполняется цикл прерывания, если прерывания разрешены глобально и в настоящее время на шине БЭВМ есть запрос на прерывание от одного из КВУ. Данный регистр входит в состав PS в 6-ым разрядом;  
  **КВУ 中断寄存器**。 如果全局启用中断并且当前在计算机总线上有来自 КВУ 之一的中断请求，则执行中断周期。 该寄存器是第 6 位 PS 的一部分；
- **логика управления шины БЭВМ** предназначена для подключения и отключения приемо-передатчиков сигналов КВУ и процессора для осуществления обмена CPU с одним из контроллеров в один момент времени.  
  **计算机总线的控制逻辑** 设计用于连接和断开 КВУ 信号的收发器和处理器，以便一次与其中一个控制器交换 CPU。

<div align=center><img src="pic/Guide/Guide_C.12.png"></div>
<center>Таблица В. 12 Назначение регистров на шине ввода-вывода БЭВМ.<br>表 B. 12 计算机输入输出总线上的寄存器分配。</center>

Назначение регистров контроллеров внешних устройств представлены в таблице В.12.  
外部设备控制器寄存器的用途如表 B.12 所示。

- R - означает, что регистр доступен только для чтения    
  R - 表示寄存器仅可用于读取
- W - только для записи  
  W - 仅可用于写入
- R/W - доступен для обоих операций  
  R/W - 可用于两种操作

Направление обмена закодированы мнемоникой Data In для ввода данных из КВУ, Data Out - для вывода данных в КВУ, а Data i/o - для двунаправленного обмена.  
交换的方向由 Data In 助记符编码，用于从 КВУ 输入数据，Data Out - 用于向 КВУ 输出数据，Data i/o - 用于双向交换。

### 2.2 Команды ввода-вывода 输入/输出命令

Команды ввода-вывода приведены на рисунке В.13. Указан формат команды, в котором код операции представлен значением 0x1 в разрядах с 12 по 15. В разрядах 8..11 располагается приказ на ввод-вывод, его три младших разряда декодируются аппаратно на дешифраторе приказов (DC IO), а биты с 0 по 7 кодируют адрес регистра контроллера ввода вывода, с которым осуществляется обмен. К командам добавлена операция возврата из прерывания `IRET`, которая осуществляет восстановление из стека значений регистра состояния и счетчика команд.  
I/O 命令如图 B.13 所示。 指定命令格式，其中操作码由位 12 到 15 中的值 0x1 表示。位 8..11 包含一个 I/O 指令，它的三个最低有效位由指令解码器上的硬件解码（DC IO)，位 0 到 7 编码与执行交换的 I/O 控制器的寄存器地址。 命令中增加了`IRET`中断返回操作，从堆栈中恢复状态寄存器和程序计数器的值。

- Команда `DI` запрещает прерывания, помещая в 5 бит регистра состояния '0'.  
  `DI` 命令通过将状态寄存器的第 5 位设置为“0”来禁用中断。
- Команда `EI` разрешает прерывания, помещая в 5 бит регистра состояния '1'.  
  `EI` 指令通过将状态寄存器的第 5 位设置为 '1' 来启用中断。
- Команда `IN #reg` осуществляет чтение из регистра ВУ по адресу в аккумулятор.  
  `IN #reg` 指令将地址处的 ВУ 寄存器读取到累加器中。
- Команда `OUT #reg` осуществляет запись из аккумулятора по адресу в регистр ВУ.  
  `OUT #reg` 命令从地址处的累加器写入 ВУ 寄存器。
- Команда `INT #num` вызывает программное прерывание с вектором num.  
  `INT #num` 指令导致带有向量 num 的程序中断。
- Команда `IRET` возврат из программы обработки прерывания.  
  `IRET` 指令是中断处理程序的返回。

<center>Формат команд ввода-вывода<br>I/O 命令格式</center>
<div align=center><img src="pic/Guide/Guide_C.13-1.png"></div>
<center>Команды, связанные с вводом-выводом<br>I/O 相关命令</center>
<div align=center><img src="pic/Guide/Guide_C.13-2.png"></div>
<center>Рисунок В. 13 Ввода-вывод: Команды и формат.<br>图 B. 13 I/O 命令与格式。</center>

### 2.3 Программно-управляемый асинхронный обмен 软件控制的异步交换

При использовании программно-управляемого асинхронного обмена должна быть составлена программа, обеспечивающая пересылку данных из памяти ЭВМ в аккумулятор и далее в регистр памяти контроллера ВУ (вывод данных) или из регистра данных контроллера ВУ в аккумулятор и затем в память ЭВМ (ввод данных). Программа такого обмена строится так: сначала проверяется готовность ВУ к обмену и если оно готово, то дается команда на обмен. ВУ сообщает о готовности установкой флага в 6-м разряде регистре SR.  
当使用程序控制的异步交换时，必须编译一个程序，提供从计算机内存到累加器，然后到 ВУ 控制器的内存寄存器（数据输出）或从 ВУ 控制器的数据寄存器到累加器，然后到计算机内存（数据输入）。 这种交换的程序是这样构建的：首先，检查 ВУ 是否准备好交换，如果准备好，则发出交换命令。 ВУ 通过在 SR 寄存器的第 6 位设置一个标志来报告准备就绪。

Пример. С помощью устройства ввода ВУ-2 (DR#4, SR#5) записать в ячейку в памяти коды символов слова "ДА" в кодировке K0I8-R. Пример программы представлен в табл. В.14.  
例子。 使用 ВУ-2 输入设备（DR#4、SR#5），将 K0I8-R 编码中单词“YES”的字符代码写入内存中的一个单元格。 示例程序如表所示。 B.14。

<div align=center><img src="pic/Guide/Guide_C.14.png"></div>
<center>Таблица В. 14 Ввод данных с использованием ВУ-2 Ассеблерный листинг.<br>表 B.14 使用 VU-2 汇编器列表的数据输入。</center>
<center>Листинг примера: Ввод двух символов с устройства ввода ВУ-2 (DR#4, SR#5)<br>示例清单：从 ВУ-2 输入设备（DR#4、SR#5）输入两个字符
</center>

В начале программа висит в ожидании готовности: считывается статусный (с номером 5) регистр ВУ-2, который передается через шину данных в 6 разряде числа, сравнивается с 0x40 (01000000г), и пока устройство не готово (SR равен 0). Такие циклы с неопределенным временем завершения, называются циклами “spin-loop”, они постоянно проверяет готовность устройства или переменной в программе, загружая процессор. Как только 6 разряд SR принимает значение 1 (устройство готово), в регистр данных ВУ считывается в младшие 8 разрядов аккумулятора, старшие разряды АС при этом остаются не изменными. Для того, чтобы подготовить АС к приему второго символа, происходит обмен байтов аккумулятора при помощи  команды `SWAB`, и сохранение этого символа в старших разрядах в ячейку результата. Далее снова происходит ожидание готовности устройства, после получения готовности загружается ячейка с результатом и считывается 2 символ в младшую часть аккумулятора. Готовое слово с двумя символами в аккумуляторе сохраняется в ячейку результата.  
一开始，程序挂起等待就绪：状态寄存器（编号为5）ВУ-2 被读取，通过数据总线在编号的第 6 位传输，与 0x40（01000000g）比较，直到设备准备就绪（SR 为 0）。这种具有无限完成时间的循环称为“自旋循环”循环，它们不断检查程序中设备或变量的准备情况，加载处理器。一旦 SR 的第 6 位取值 1（设备准备就绪），ВУ 数据寄存器就被读入累加器的低 8 位，而 AC 的高位保持不变。为了准备 AU 接收第二个字符，累加器的字节使用 `SWAB` 命令交换，并且该字符存储在结果单元的高位中。接下来，设备再次等待准备就绪，在收到准备就绪后，加载具有结果的单元格并将第二个字符读入累加器的低位。累加器中包含两个字符的完成单词存储在结果单元格中。

Необходимо еще раз подчеркнуть, что ввод-вывод происходит только с младшей частью аккумулятора, старшая часть во время выполнения команд `IN` ли `OUT` не изменяется. Также важно, что при данной реализации асинхронного обмена ЭВМ тратит время на ожидание (неопределенно долгое!) момента готовности циклически опрашивая флаг (spin-loop) и не может выполнять никакой другой работы. Разумная организация процедур ввода-вывода позволяет избегать такого зацикливание, например через периодический опрос флага при выполнении основной программы или через прерывания.  
必须再次强调，I/O 只发生在累加器的下部，在执行 `IN` 或 `OUT` 命令期间上部不会改变。同样重要的是，通过这种异步交换的实现，计算机通过循环轮询标志（自旋循环）花费时间（无限期地！）等待准备就绪，并且不能执行任何其他工作。 I/O 过程的合理组织可以让您避免这样的循环，例如，通过在主程序执行期间定期轮询标志或通过中断。

### 2.4 Управляемый по прерыванию программы ввод-вывод 中断驱动的 I/O

Этот вид обмена отличается от асинхронного тем, что сигнал готовности ВУ к обмену анализируется не программным, а аппаратным путем. ЭВМ может выполнять любую не связанную с обменом программу (будем называть ее основной).  
这种交换与异步交换的不同之处在于，交换 ВУ 的就绪信号不是由软件分析，而是由硬件分析。 一台计算机可以执行任何与交易所无关的程序（我们称之为主程序）。

Когда будет нажата кнопка готовности, то в случае, если в контроллере прерывания разрешены (наприме, реализуется через схему „И“ регистра состояния SR и старшего бита регистра управления MR, рис. В.11, контроллер КВУ-1) поступает сигнал "Запрос прерывания" по линии IntRq. После чего этот сигнал поступит на схему „И“ центрального процессра В.11 с 5 битом регистра состояния (EI - разрешение прерываний) проверяющий разрешены ли прерывания в ЭВМ и записывающий результат схемы в 6 бит регистра состояния (INT - прерывание). После цикла исполнения очередной инструкции основной программы в ЭВМ будет запущен комплекс программ, проверяющий, было ли требование прерывания, и если было, то формирует управляющий сигнал "Предоставление прерывания" IntSC, который последовательно проходит через все контроллеры (сигналы IntSCo - выходной и IntSCi - входной) и проверяет было ли в этом контроллере прерывание. Когда сигнал доходит до нужного контроллера, то он выставляет на шину адреса свой номер вектора прерывания (см. рис. В.15). После чего процессор по номеру прерывания вызывает программу обработки прерывания.  
当按下就绪按钮时，如果控制器中允许中断（例如通过 SR 状态寄存器的“与”电路和 MR 控制寄存器的高位实现，图 B.11，КВУ- 1 控制器），信号“中断请求”在线 IntRq。之后，此信号将与状态寄存器的 5 位（EI - 中断使能）进入中央处理器 B.11 的“与”电路，检查计算机是否允许中断，并将电路的结果写入状态寄存器的 6 位（INT - 中断）。在主程序的下一条指令执行周期后，计算机会启动一组程序，检查是否有中断请求，如果有，则产生控制信号“Granting an interrupt” IntSC，即依次通过所有控制器（信号 IntSCo - 输出和 IntSCi - 输入）并检查此控制器中是否存在中断。当信号到达所需的控制器时，它将其中断向量号放在地址总线上（见图 B.15）。之后，处理器通过中断号调用中断处理程序。

Ячейки памяти с адресами О-OxF отведены для инициализации векторов прерывания, по 2 ячейки на каждый вектор. В начале программы все контроллеры ВУ, в которых должны вызывать прерывания должны быть проинициализированы.  
地址为 O-OxF 的存储单元保留用于初始化中断向量，每个向量 2 个单元。 在程序开始时，所有要调用中断的 ВУ 控制器都必须初始化。

Если прерывания разрешены, то после выполнения всех команд кроме `HLT`, а также если режим выполнения БЭВМ установлен в значение "РАБОТА", выполняются следующие действия:  
如果启用了中断，则在执行除 `HLT` 之外的所有命令后，并且如果计算机执行模式设置为“РАБОТА”，则执行以下操作：

<div align=center><img src="pic/Guide/Guide_C.15.png"></div>
<center>Рисунок В. 15 Распространение сигналов предоставления прерывания<br>图 B.15 中断准许信号的传播</center>


- Шаг 1. По завершению цикла исполнения текущей команды происходит переход на цикл прерывания. Если в этот момент 6 бит регистра состояния INT (прерывание) не равен 1, то происходит переход к следующей команде. При наличии требования прерывания БЭВМ формирует сигнал "Предоставление прерывания" (IntSC) через выполнение микрокоманды `INTS`.  
  Step 1. 当前命令的执行周期结束后，进入中断周期。 如果此时状态寄存器 INT（中断）的第 6 位不等于 1，则转移到下一条指令。 如果有中断请求，计算机通过执行 `INTS` 微指令产生一个“Interrupt Grant”（IntSC）信号。
- Шаг 2. Сохраняется счетчик команд и регистр состояния БЭВМ в стеке.  
  步骤 2. 程序计数器和计算机状态寄存器存储在堆栈中。
- Шаг 3. Младшие 8 разрядов (номер вектора прерывания) записываются в буферный регистр и вычисляется адрес с переходом на подпрограмму обработки прерывания, как номер вектора * 2, после чего тот записывается в DR, а после в IP.  
  Step 3. 将低 8 位（中断向量号）写入缓冲寄存器，并计算地址，转移到中断处理程序作为向量号 * 2，然后写入 DR，然后写入 IP .
- Шаг 4. Далее к младшим 8 разрядам буферного регистра прибавляется 1, чтобы выбрать адрес следующей ячейки вектора прерывания (новый регистр состояния PS), ограничивая результат 8-ю разрядами. После чего по этому адресу содержимое в памяти записывается в DR, а после в PS.  
  Step 4. 接下来，将缓冲寄存器的低 8 位加 1 以选择中断向量的下一个位置（新的 PS 状态寄存器）的地址，将结果限制为 8 位。 之后，在这个地址，内存中的内容被写入 DR，然后写入 PS。
- Шаг 5. Контроллер прерываний вновь переводится в состояние разрешение прерывания командой ei и осуществляется возврат к выполнению прерванной программы, т.е. к команде, адрес которой хранится в стеке, также восстанавливается сохраненный регистр состояния из стека.  
  Step 5. 中断控制器通过 ei 命令返回中断使能状态，被中断的程序返回执行，即 对于地址存储在堆栈中的指令，保存的状态寄存器也从堆栈中恢复。

   > Пример. Составить программу, которая постоянно наращивает на 1 содержимое аккумулятора. Восемь младших разрядов удвоенного значения аккумулятора должны выводиться на ВУ-1 по его запросу, а по запросу ВУ-3 содержимое регистра данных ВУ-3 должно записаться в ячейку 3F.  
   > 例子。 编写一个程序，将累加器的内容连续加 1。 累加器的加倍值的最低八位应根据 ВУ-1 的请求输出到 ВУ-1，应 ВУ-3 的请求，应将 ВУ-3 数据寄存器的内容写入单元 3F。

<center>示例列表：ВУ1 的准备情况：2*A-> РДВУ1，ВУЗ 的准备情况：РДВУЗ-> яч.3F</center>

<div align=center><img src="pic/Guide/Guide_C.16-1.png"></div>
<div align=center><img src="pic/Guide/Guide_C.16-2.png"></div>

<center>Таблица В. 16
Ввод данных с использованием прерываний. Ассемблерный листинг.<br>使用中断输入数据。 汇编列表。</center>


Если эту программу занести в память базовой ЭВМ, установить в СК пусковой адрес 20 и нажать кнопку ПУСК, то начнет выполняться бесконечный цикл наращивания содержимого аккумулятора. Когда же на пульте управления (рис В.11) будет нажата любая из кнопок готовности ВУ, то будет выполнен переход к подпрограмме обработки прерываний.  
如果将该程序输入到主机的内存中，在 СК 中设置起始地址 20 并按下 ПУСК 按钮，则将开始进行无限循环的增加电池内容。 当按下控制面板上的任何 ВУ 就绪按钮时（图 B.11），将转换到中断处理子程序。

Для отладки программы (табл. В.8) в ней используются точки останова. Если в ячейке памяти точки останова расположена команда `NOP`, то программа выполняется в обычном, не отладочном режиме. Если вместо `NOP` поместить команду `HLT`, то программа во время выполнения остановится и будет возможно проконтролировать содержимое регистров и ячеек памяти. После завершения контроля необходимо продолжить дальнейшее исполнение программы. В приведенном примере точки останова позволяют исследовать содержимое аккумулятора в момент возникновения прерывания, а так же правильность подсчета и вывода на ВУ-3 удвоенного его значения.  
为了调试程序（表 B.8），它使用断点。如果 `NOP` 命令位于断点存储单元中，则程序以正常的非调试模式执行。如果我们使用 `HLT` 命令代替 `NOP`，那么程序将在执行期间停止，并且可以检查寄存器和内存单元的内容。控制完成后，需要继续执行程序。在上面的例子中，断点可以让你在中断发生的那一刻检查累加器的内容，以及计数的正确性并将其双倍值输出到 ВУ-3。


# <center> Приложение Д. Ассемблер БЭВМ. Краткий справочник <br>附录 D. BEVM 汇编器。 快速参考</center>

Для упрощения разработки программ для БЭВМ и более наглядного их представления разработан язык ассемблера, позволяющий использовать дополнительные возможности для разработки программ.  
为了简化计算机程序的开发和更直观的表示，已经开发了一种汇编语言，允许您使用附加功能来开发程序。

**Синтаксис 语法**

Назначение<br>用途|Синтаксис<br>语法|Пример использования<br>实例
---|---|---
Размещение в памяти<br>内存布局 | ORG адрес | ORG 0x10
Адресная команда<br>寻址指令 | [метка:] МНЕМОНИКА АРГУМЕНТ | LD X /прямая относительная <br> ST $Y /прямая абсолютная <br> LD -(X) <br> JUMP (VALUES) <br> SWAM (ARRAY)+
Безадресная команда<br>非寻址指令 | [метка:] МНЕМОНИКА | START: CLA
Команда ввода-вывода<br>输入输出指令 | [метка:] МНЕМОНИКА АДРЕСВУ | OUT 0x3
Константы<br>常量 | [метка:] WORD значение [,значение...] [[метка:] WORD количество DUP(значение) | X: WORD ? <br> Y: WORD X <br> VALUES: WORD 1,2,3 <br> ARRAY: WORD 10 DUP (?)


Метки, команды, их аргументы и т.п. должны быть отделены друг от друга пробелом или символом табуляции.  
标签、命令、它们的参数等。 必须用空格或制表符相互分隔。

## <center>Часть 3. Микропрограммное устройство управления <br> 第三部分：固件控制设备</center>

### 3.1. Микропрограммное управление вентильными схемами 固件门电路控制

Процесс выборки, дешифрации и исполнения команд ЭВМ состоит из последовательности элементарных операций (например, пересылка содержимого одного регистра 8 другой регистр или проверка определенного бита в каком-либо регистре). Для выполнения таких микроопераций, как правило, достаточно подать открывающий сигнал на одну или несколько вентильных схем, связывающих между собой два регистра, регистр и АЛУ и (или) перестраивающих АЛУ на выполнение заданной операции (сложения, логического умножения и т.п.). Требуемая последовательность сигналов на вентильные схемы ЭВМ вырабатывается ее устройством управления, связанным с тактовым генератором.  
选择、解码和执行计算机命令的过程由一系列基本操作组成（例如，将一个寄存器 8 的内容传送到另一个寄存器或检查任何寄存器中的某个位）。为了执行这样的微操作，作为一项规则，将打开信号应用到一个或多个将两个寄存器、一个寄存器和一个 ALU 互连的门电路和（或）重建 ALU 以执行给定的操作（加法，逻辑乘法等）。计算机阀电路所需的信号序列由与时钟发生器相关的控制装置产生。

<div align=center><img src="pic/Guide/Guide_C.17.png"></div>

<center>Рисунок В. 17 Микропрограммное устройство управления БЭВМ с блоком регистров и АЛУ<br>图 C. 17 具有寄存器块和 ALU 的计算机的固件控制单元</center>

Микропрограммное устройство управления (МПУ) базовой ЭВМ - это, в свою очередь, очень простая ЭВМ, для которой регистры и вентильные схемы процессора являются как бы устройствами ввода-вывода (рис. В.17).  
基础计算机的微程序控制单元 (MPU) 又是一个非常简单的计算机，处理器的寄存器和门电路可以说是输入输出设备（图 B.17）。

Программа работы такой ЭВМ называется микропрограммой, а ее команды, содержащие информацию об элементарных действиях, выполняемых в течение одного рабочего такта ЭВМ, - микрокомандами. В одном из вариантов реализации МПУ используется всего два типа микрокоманд - операционная и управляющая.  
这种计算机的工作程序称为微程序，其包含有关计算机一个工作周期内执行的基本动作的信息的指令称为微指令。 在实现 MPU 的选项之一中，仅使用两种类型的微指令——操作和控制。

Микропрограмма обычно хранится в постоянном запоминающем устройстве - памяти микрокоманд, но в эмуляторе БЭВМ реализована возможность изменения микропрограммы. В каждом такте работы ЭВМ из этой памяти в регистр микрокоманд (РМК) пересылается очередная микрокоманда, т.е. микрокоманда, на которую указывает счетчик микрокоманд (СчМК), одновременно выполняющий функции регистра адреса микрокоманд.  
微程序通常存储在只读存储器——微命令存储器中，但计算机仿真器具有改变微程序的能力。 在计算机运行的每个周期中，下一条微指令都会从这个存储器发送到微指令寄存器（RMC），即 由微指令计数器（CHMK）指向的微指令，它同时执行微指令地址寄存器的功能。

Существует 2 типа микрокоманд (рис. В. 18) - операционная (ОМК) и управляющая (УМК). Биты 0-15 обоих типов совпадают, логика остальных зависит от типа. В 39-ый бит РМК записывается код операции, исходя из которого происходит выбор типа микрокоманды (0 - для ОМК; 1 - для УМК). Этот сигнал подается напрямую на вентили УМК (16-32 биты РМК) и через инвертор на вентили ОМК (16- 35 биты РМК), открывая/закрывая биты УМК/ОМК, тем самым производя выбор типа микрокоманды.  
有 2 种类型的微命令（图 B.18） - 操作（OMK）和控制（UMK）。 两种类型的位 0-15 相同，其余的逻辑取决于类型。 在 RMK 的第 39 位中写入操作码，根据该操作码选择微指令类型（0 - 表示 OMK；1 - 表示 UMK）。 该信号直接馈送到 UMK 门（16-32 位 RMK）并通过反相器馈送到 OMK 门（16-35 位 RMK），打开/关闭 UMK/OMK 位，从而选择微命令的类型。

Разряды РМК, содержащие 1, создают открывающий управляющий сигнал, а содержащие 0 - закрывающий. Подобная структура микрокоманды, где каждый бит используется для создания отдельного управляющего сигнала, называется горизонтальной.  
包含 1 的 RMK 位创建打开控制信号，包含 0 的 RMK 位创建关闭控制信号。 这种微指令结构，其中每个位用于创建单独的控制信号，称为水平。

Так как биты 0-15 обоих типов микрокоманд совпадают, то назначение у них одинаковое, биты 0-7 отвечают за сигналы чтения регистров, регистры 8-11 отвечают за действия в АЛУ, биты 12-15 отвечают за сигналы передачи в коммутаторе. Далее назначение битов в каждом типе отличается:  
由于这两种微指令的位 0-15 是相同的，所以它们的用途是相同的，位 0-7 负责寄存器读取信号，寄存器 8-11 负责 ALU 中的动作，位 12-15 负责在开关中传输信号。 此外，每种类型的位分配是不同的：

- ОМК: биты 16-23 отвечают за сигналы преобразований и установки флагов в коммутаторе;
- ОМК: биты 24-31 - запись в регистр результат преобразований;
- ОМК: биты 32-33 - взаимодействие с памятью БЭВМ
- ОМК: биты 34-35 - взаимодействие с внешними устройствами
- ОМК: бит 38 - HALT, бит останова.
- УМК: биты 16-23 - выбор бита для сравнения, работающий по схеме „ИЛИ“ с данными поступающими из коммутатора;
- УМК: биты 24-31 задают адрес перехода, куда перейдет программа в случае, если схема инверсного ,,XOR“ даст положительный результат (бит сравнения и результат схемы „И“ выбора бита одинаковы);
- УМК: бит 32 - поле для сравнения с схеме инверсного "XO".

  ---
- ОМК：第 16-23 位负责转换信号和设置开关中的标志；
- ОМК：第 24-31 位 - 将转换结果写入寄存器；
- ОМК：位 32-33 - 与计算机内存的交互
- ОМК：位 34-35 - 与外部设备的交互
- ОМК：位 38 - HALT，停止位。
- УМК：位 16-23 - 用于比较的位选择，根据“或”方案与来自开关的数据一起工作；
- УМК：第 24-31 位设置程序在逆 ,,XOR" 方案给出肯定结果时将执行的转换地址（比较位和位选择“AND”方案的结果相同）；
- УМК：第 32 位 - 用于与逆“XO”方案进行比较的字段。

Справочная информация об отдельных операциях в микрокоманде приведена в табл. 8.19.  
表 B.19 中给出了有关微指令中各个操作的参考信息。 

<div align=center><img src="pic/Guide/Guide_C.18.png"></div>

<center>Рисунок В. 18 Форматы микрокоманд<br>图 B.18 微指令格式</center>

1. Для вычитания содержимого DR из содержимого АС и записи результата в буферный регистр (АС-DR—>BR) следует выполнить микрокоманду:  
  (0000 0000 0010 0000 0000 0000 1001 0101 0001 0001)2 = (0020009511)16,  
т.е. одновременно подать единичные управляющие сигналы на чтение аккумулятора RDAC и регистра данных RDDR. Тогда к уменьшаемому прибавится обратный код вычитаемого и к этой сумме добавится единица, что эквивалентно АС + (-DR), а после записываем результат в буферный регистр.
2. Для сложения содержимого АС с содержимым DR и записью результата в буферный регистр с выставлением флагов (AC+DR—>BR, NZVC) следует выполнить микрокоманду:  
  (0000 0000 0010 0000 1110 0000 1001 0000 0001 0001)2 = (0020009511)16,  
  т.е. одновременно подать единичные управляющие сигналы на чтение аккумулятора RDAC и регистра данных RDDR. Тогда левый и правый вход АЛУ суммируются, выставятся флаги и результат запишется в буферный регистр.  
3. Для возведения в дополнительный код содержимого АС и записи результата в АС с выставлением флагов (~АС + 1—>АС, NZVC) следует выполнить микрокоманду:  
  (0000 0000 0001 0000 1110 0000 1001 0110 0001 0000)2 = (0010809610)is,
т. е. подать сигнал на чтение аккумулятора RDAC. Тогда, к обратному код левого входа прибавится единица, что эквивалентно -АС + 0, а после выставляются флаги и записыватся результат в аккумулятор.

  ---
1. 要从AC的内容中减去DR的内容并将结果写入缓冲寄存器（AC-DR—>BR），执行微指令：
  (0000 0000 0010 0000 0000 0000 1001 0101 0001 0001)2 = (0020009511)16,
那些。同时应用单个控制信号来读取 RDAC 累加器和 RDDR 数据寄存器。然后将减数的反码加到被减数上，这个和加一，相当于AC+(-DR)，然后我们把结果写入缓冲寄存器。
2. 要将 AC 的内容与 DR 的内容相加，并将结果写入带有标志设置的缓冲寄存器 (AC+DR—>BR, NZVC)，请执行以下微指令：
  (0000 0000 0010 0000 1110 0000 1001 0000 0001 0001)2 = (0020009511)16,
  那些。同时应用单个控制信号来读取 RDAC 累加器和 RDDR 数据寄存器。然后将 ALU 的左右输入相加，设置标志，并将结果写入缓冲寄存器。
3. 要将 AC 的内容提升为附加代码并将结果写入带有标志设置的 AC (~AC + 1—>AC, NZVC)，请执行以下微命令：
  (0000 0000 0001 0000 1110 0000 1001 0110 0001 0000)2 = (0010809610) 是，
即，发送信号以读取 RDAC 电池。然后，将左输入的逆码加一，相当于-AC + 0，然后设置标志位并将结果写入累加器。

Рассмотрим две управляющих микрокоманды:
1. Переход к команде, расположенной по адресу, на которую указывает адресная часть команды, если аккумулятор содержит нечетное число.  
  (1000 0001 0101 1100 0000 0001 0001 0000 0001 0000)2 = (815С011010)16  
  Микрокоманда подает сигнал на чтение аккумулятора RDAC, прямую передачу младшего байта и выбор нулевого бита данных, поступивших с коммутатора для сравнения. Далее задается адрес перехода и поле сравнения равное 1.  
  Эта микрокоманда переходит на метку BR @ 5С, в которой происходит:  
  5С 0020011002 extend sign CR(0..7) ? BR - расширение знака  
  5D 0004009024 BR + IP ? IP - сложение буферного регистра BR с счетчиком  
  команд IP и запись в счетчик IP  
  5Е 80С4101040 GOTO INT @ C4 - переход к циклу прерывания (обязателен в конце каждой инструкции, обратите на это внимание при выполнении лабораторной работы).  
2. Для организации безусловного перехода (например, по адресу 90) используется 4-й бит регистра состояний, содержащий константу 0 (см. табл. В.20). Сравнение этого разряда с нулем, записанным в 32-ый разряд УМК, всегда дает положительный результат и позволяет переслать в СчМК нужный адрес перехода. Микрокоманда, реализующая эту операцию, имеет вид:  
  (1000 0000 0101 1100 0001 0000 0001 0000 0100 0000)2 = (805С101040)16.

  ---
考虑两个控制微指令：
1. 如果累加器包含奇数，则跳转到位于指令地址部分指向的地址的指令。
  (1000 0001 0101 1100 0000 0001 0001 0000 0001 0000)2 = (815С011010)16
  微指令发送信号读取 RDAC 累加器，直接传输低字节并选择从开关接收到的数据的零位进行比较。接下来，设置转换地址，比较字段等于 1。
  该微指令跳转到标签 BR @ 5C，其中：
  5С 0020011002 扩展符号 CR(0..7) ? BR - 符号扩展
  5D 0004009024 BR + IP ？ IP - 添加缓冲寄存器 BR 和计数器
  IP 命令和写入 IP 计数器
  5E 80С4101040 GOTO INT @ C4 - 跳转到中断循环（需要在每条指令的末尾，做实验时要注意这一点）。
2. 组织无条件跳转（例如，到地址 90），使用状态寄存器的第 4 位，包含常数 0（见表 B.20）。将此数字与写在 UMK 的第 32 位数字中的零进行比较，总是给出肯定的结果，并允许您将所需的跳转地址发送到 SCHMK。实现此操作的微命令如下所示：
  (1000 0000 0101 1100 0001 0000 0001 0000 0100 0000)2 = (805C101040)16。

<div align=center><img src="pic/Guide/Guide_C.19.png"></div>

<center>Таблица В. 19.<br>表 B. 19.</center>

<div align=center><img src="pic/Guide/Guide_C.20.png"></div>

<center>Таблица В. 20.<br>表 B. 20.</center>

##  3.2 Интерпретатор базовой ЭВМ

Полный текст микропрограммы (интерпретатора команд) приведен в табл. В.21. Интерпретатор состоит из нескольких блоков:  
微程序（命令解释器）的全文在表 21 中给出。 释器由几个块组成：

- Цикл выборки команд
- Цикл выборки адреса операнда и обработки режимов адресации 
- Цикл выборки операнда
- Цикл исполнения
  - Декодирование и исполнение адресных команд
  - Декодирование и исполнение ветвлений
  - Декодирование и исполнение безадресных команд
- Декодирование и исполнение команд ввода-вывода 
- Цикл прерывания
- Пультовые операции
  - Свободные ячейки для:
  - Арифметической команды - Команды перехода
  - Безадресной команды

 ---
- 命令获取循环
- 操作数地址获取周期和寻址模式处理
- 操作数获取循环
- 执行周期
   - 地址命令的解码和执行
   - 分支的解码和执行
   - 未寻址命令的解码和执行
- I/O 命令的解码和执行
- 中断周期
- 控制台操作
   - 免费插槽：
   - 算术命令 - 跳转命令
   - 未寻址的命令

Память микрокоманд содержит 256 ячеек для хранения микрокоманд, включая резерв. Формат микрокоманд - горизонтальный.  
微指令存储器包含256个微指令存储位置，包括一个备用。 微指令格式是横向的。

<div align=center><img src="pic/Guide/Guide_C.21-1.png"></div>

<div align=center><img src="pic/Guide/Guide_C.21-2.png"></div>

<div align=center><img src="pic/Guide/Guide_C.21-3.png"></div>

<div align=center><img src="pic/Guide/Guide_C.21-4.png"></div>

<center>Таблица В. 21.<br>表 B. 21.</center>

<style type="text/css">
    #footer {
        position: relative;
        margin: 0 auto;
        line-height: 20px;
        text-align: center;
        font-size: 12px;
        letter-spacing: 1px;
    }
 
    .content {
        height: 1800px;
        width: 100%;
        text-align: center;
    }
</style>

<div id="footer">
    Powered by
    <a href="https://html5up.net">HTML</a>, 
    <a href="https://markdown.com.cn/">markdown</a>, 
    <a href="https://www.latex-project.org/">LaTeX</a>
    <br>
    Copyright © 2022 | 
    <a href="https://tolia-gh.github.io">Tolia</a>
    <br>
    All Rights Reserved.
    <br>
</div>